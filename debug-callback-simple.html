<!DOCTYPE html>
<html>
<head>
    <title>回调简单测试</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        pre { background: #111; padding: 10px; border: 1px solid #333; }
    </style>
</head>
<body>
    <h1>简单回调测试</h1>
    <pre id="log"></pre>
    
    <script type="module">
        const log = document.getElementById('log');
        function print(msg) {
            log.textContent += new Date().toTimeString() + ': ' + msg + '\n';
            console.log(msg);
        }
        
        print('开始测试...');
        
        try {
            // 直接导入MP4Parser
            const { MP4Parser } = await import('./src/parser/mp4-parser.js');
            print('MP4Parser导入成功');
            
            // 创建实例
            const parser = new MP4Parser();
            print('MP4Parser实例创建成功');
            
            // 检查初始状态
            print('初始onReady: ' + typeof parser.onReady);
            print('初始onSamples: ' + typeof parser.onSamples);
            print('初始onError: ' + typeof parser.onError);
            
            // 设置回调
            parser.onReady = function(info) {
                print('🎉 onReady被调用了！info: ' + JSON.stringify(info));
            };
            
            parser.onError = function(error) {
                print('❌ onError被调用: ' + error);
            };
            
            // 验证设置
            print('设置后onReady: ' + typeof parser.onReady);
            print('设置后onError: ' + typeof parser.onError);
            
            // 初始化
            print('开始初始化...');
            parser.init();
            print('初始化完成');
            
            // 再次检查
            print('初始化后onReady: ' + typeof parser.onReady);
            print('初始化后onError: ' + typeof parser.onError);
            
            print('测试完成 - 等待手动文件测试');
            
        } catch (error) {
            print('错误: ' + error.message);
            console.error(error);
        }
    </script>
</body>
</html>