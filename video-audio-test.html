<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ è§†é¢‘éŸ³é¢‘è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .section {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #404040;
        }
        .test-item {
            margin: 15px 0;
            padding: 15px;
            background: #333;
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background: #28a745; color: white; }
        .status.error { background: #dc3545; color: white; }
        .status.warning { background: #ffc107; color: black; }
        .status.info { background: #17a2b8; color: white; }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #005a99; }
        video, canvas { 
            max-width: 100%; 
            border: 2px solid #666; 
            border-radius: 8px;
            background: #000;
        }
        .log {
            background: #1e1e1e;
            border: 1px solid #555;
            border-radius: 6px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        input[type="file"] {
            padding: 10px;
            background: #2a2a2a;
            border: 2px dashed #666;
            border-radius: 8px;
            color: white;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è§†é¢‘éŸ³é¢‘è¯Šæ–­å·¥å…·</h1>
    <p>ç”¨äºå¿«é€Ÿè¯Šæ–­æ’­æ”¾å™¨æ— å£°éŸ³æ— ç”»é¢é—®é¢˜</p>

    <!-- 1. æµè§ˆå™¨èƒ½åŠ›æ£€æµ‹ -->
    <div class="section">
        <h2>ğŸŒ æµè§ˆå™¨èƒ½åŠ›æ£€æµ‹</h2>
        <div id="browser-capabilities"></div>
    </div>

    <!-- 2. HTML5 Videoæµ‹è¯• -->
    <div class="section">
        <h2>ğŸ“¹ HTML5 Video æµ‹è¯•</h2>
        <input type="file" id="videoFile" accept="video/*">
        <div class="test-item">
            <video id="testVideo" controls style="width: 100%; max-width: 600px;"></video>
        </div>
        <div id="video-info"></div>
    </div>

    <!-- 3. Canvasæ¸²æŸ“æµ‹è¯• -->
    <div class="section">
        <h2>ğŸ¨ Canvas æ¸²æŸ“æµ‹è¯•</h2>
        <div class="test-item">
            <canvas id="testCanvas" width="400" height="300"></canvas>
            <br>
            <button onclick="testCanvasRendering()">æµ‹è¯•Canvasæ¸²æŸ“</button>
        </div>
    </div>

    <!-- 4. éŸ³é¢‘ç³»ç»Ÿæµ‹è¯• -->
    <div class="section">
        <h2>ğŸ”Š éŸ³é¢‘ç³»ç»Ÿæµ‹è¯•</h2>
        <div class="test-item">
            <button onclick="testAudioContext()">æµ‹è¯•AudioContext</button>
            <button onclick="playTestTone()">æ’­æ”¾æµ‹è¯•éŸ³è°ƒ</button>
            <button onclick="stopTestTone()">åœæ­¢éŸ³è°ƒ</button>
        </div>
        <div id="audio-info"></div>
    </div>

    <!-- 5. å®æ—¶æ—¥å¿— -->
    <div class="section">
        <h2>ğŸ“‹ å®æ—¶è¯Šæ–­æ—¥å¿—</h2>
        <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        <div id="log" class="log"></div>
    </div>

    <script>
        let audioContext = null;
        let oscillator = null;
        let testVideo = null;

        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = {
                info: '#17a2b8',
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107'
            }[type];
            
            logEl.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // æµè§ˆå™¨èƒ½åŠ›æ£€æµ‹
        function checkBrowserCapabilities() {
            const capabilities = document.getElementById('browser-capabilities');
            let html = '';
            
            const tests = [
                { name: 'HTML5 Video', test: () => !!document.createElement('video').canPlayType },
                { name: 'Canvas 2D', test: () => !!document.createElement('canvas').getContext('2d') },
                { name: 'WebGL', test: () => !!document.createElement('canvas').getContext('webgl') },
                { name: 'WebGL2', test: () => !!document.createElement('canvas').getContext('webgl2') },
                { name: 'WebGPU', test: () => !!navigator.gpu },
                { name: 'AudioContext', test: () => !!(window.AudioContext || window.webkitAudioContext) },
                { name: 'WebCodecs VideoDecoder', test: () => typeof VideoDecoder !== 'undefined' },
                { name: 'WebCodecs AudioDecoder', test: () => typeof AudioDecoder !== 'undefined' },
                { name: 'AudioWorklet', test: () => !!(window.AudioWorklet) },
                { name: 'OffscreenCanvas', test: () => typeof OffscreenCanvas !== 'undefined' },
                { name: 'SharedArrayBuffer', test: () => typeof SharedArrayBuffer !== 'undefined' }
            ];

            tests.forEach(({ name, test }) => {
                const supported = test();
                const status = supported ? 'success' : 'error';
                html += `<div class="test-item">
                    ${name}: <span class="status ${status}">${supported ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</span>
                </div>`;
                log(`${name}: ${supported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`, supported ? 'success' : 'warning');
            });

            capabilities.innerHTML = html;
        }

        // Canvasæ¸²æŸ“æµ‹è¯•
        function testCanvasRendering() {
            const canvas = document.getElementById('testCanvas');
            const ctx = canvas.getContext('2d');
            
            if (!ctx) {
                log('Canvas 2D contextè·å–å¤±è´¥', 'error');
                return;
            }

            log('å¼€å§‹Canvasæ¸²æŸ“æµ‹è¯•', 'info');
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶å½©è‰²çŸ©å½¢
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            colors.forEach((color, i) => {
                ctx.fillStyle = color;
                ctx.fillRect(i * 60, 50, 50, 100);
            });
            
            // ç»˜åˆ¶æ–‡å­—
            ctx.fillStyle = '#white';
            ctx.font = '20px Arial';
            ctx.fillText('Canvasæ¸²æŸ“æµ‹è¯•', 50, 200);
            
            // ç»˜åˆ¶åŠ¨ç”»åœ†åœˆ
            let frame = 0;
            function animate() {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.fillRect(0, 220, canvas.width, 80);
                
                ctx.fillStyle = '#00ff00';
                ctx.beginPath();
                ctx.arc(200 + Math.sin(frame * 0.1) * 100, 250, 20, 0, Math.PI * 2);
                ctx.fill();
                
                frame++;
                if (frame < 60) {
                    requestAnimationFrame(animate);
                } else {
                    log('Canvasæ¸²æŸ“æµ‹è¯•å®Œæˆ', 'success');
                }
            }
            animate();
        }

        // éŸ³é¢‘ç³»ç»Ÿæµ‹è¯•
        function testAudioContext() {
            try {
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                if (!AudioContextClass) {
                    log('AudioContextä¸æ”¯æŒ', 'error');
                    return;
                }

                audioContext = new AudioContextClass();
                log(`AudioContextåˆ›å»ºæˆåŠŸ: ${audioContext.state}, é‡‡æ ·ç‡: ${audioContext.sampleRate}Hz`, 'success');
                
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        log('AudioContextå·²æ¿€æ´»', 'success');
                    });
                }

                document.getElementById('audio-info').innerHTML = `
                    <div class="test-item">
                        <strong>AudioContextçŠ¶æ€:</strong> ${audioContext.state}<br>
                        <strong>é‡‡æ ·ç‡:</strong> ${audioContext.sampleRate}Hz<br>
                        <strong>ç›®æ ‡å»¶è¿Ÿ:</strong> ${audioContext.baseLatency || 'N/A'}s
                    </div>
                `;

            } catch (error) {
                log(`AudioContextåˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function playTestTone() {
            if (!audioContext) {
                testAudioContext();
                return;
            }

            try {
                // åœæ­¢ä¹‹å‰çš„éŸ³è°ƒ
                stopTestTone();

                // åˆ›å»º440Hzçš„æµ‹è¯•éŸ³è°ƒ
                oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                
                oscillator.start();
                log('æ’­æ”¾440Hzæµ‹è¯•éŸ³è°ƒ', 'success');
                
            } catch (error) {
                log(`éŸ³é¢‘æ’­æ”¾å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function stopTestTone() {
            if (oscillator) {
                try {
                    oscillator.stop();
                    oscillator = null;
                    log('åœæ­¢æµ‹è¯•éŸ³è°ƒ', 'info');
                } catch (error) {
                    log(`åœæ­¢éŸ³é¢‘å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        // è§†é¢‘æ–‡ä»¶æµ‹è¯•
        document.getElementById('videoFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            log(`é€‰æ‹©è§†é¢‘æ–‡ä»¶: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)`, 'info');

            testVideo = document.getElementById('testVideo');
            const url = URL.createObjectURL(file);
            testVideo.src = url;

            testVideo.addEventListener('loadedmetadata', function() {
                log(`è§†é¢‘åŠ è½½æˆåŠŸ: ${this.videoWidth}x${this.videoHeight}, æ—¶é•¿: ${this.duration.toFixed(2)}s`, 'success');
                
                document.getElementById('video-info').innerHTML = `
                    <div class="test-item">
                        <strong>åˆ†è¾¨ç‡:</strong> ${this.videoWidth} Ã— ${this.videoHeight}<br>
                        <strong>æ—¶é•¿:</strong> ${this.duration.toFixed(2)}ç§’<br>
                        <strong>è§†é¢‘è½¨é“:</strong> ${this.videoTracks ? this.videoTracks.length : 'N/A'}<br>
                        <strong>éŸ³é¢‘è½¨é“:</strong> ${this.audioTracks ? this.audioTracks.length : 'N/A'}
                    </div>
                `;
            });

            testVideo.addEventListener('play', () => log('è§†é¢‘å¼€å§‹æ’­æ”¾', 'success'));
            testVideo.addEventListener('pause', () => log('è§†é¢‘æš‚åœ', 'info'));
            testVideo.addEventListener('ended', () => log('è§†é¢‘æ’­æ”¾ç»“æŸ', 'info'));
            testVideo.addEventListener('error', (e) => log(`è§†é¢‘é”™è¯¯: ${e.message || 'æœªçŸ¥é”™è¯¯'}`, 'error'));

            // æ¸…ç†URL
            testVideo.addEventListener('loadstart', () => URL.revokeObjectURL(url));
        });

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæ£€æµ‹
        document.addEventListener('DOMContentLoaded', function() {
            log('è¯Šæ–­å·¥å…·å¯åŠ¨', 'info');
            checkBrowserCapabilities();
            
            // è‡ªåŠ¨æµ‹è¯•AudioContext
            setTimeout(testAudioContext, 1000);
        });

        // å…¨å±€é”™è¯¯æ•è·
        window.addEventListener('error', function(e) {
            log(`å…¨å±€é”™è¯¯: ${e.message} (${e.filename}:${e.lineno})`, 'error');
        });
    </script>
</body>
</html>