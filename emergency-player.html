<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¨ ç´§æ€¥ä¿®å¤ç‰ˆæ’­æ”¾å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        .file-input, .url-input, button {
            margin: 10px;
            padding: 12px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
        }
        .file-input, .url-input {
            background: #333;
            color: white;
            border: 1px solid #555;
            width: 300px;
        }
        button {
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .video-container {
            text-align: center;
            margin: 30px 0;
            background: #000;
            border-radius: 10px;
            padding: 20px;
        }
        video {
            max-width: 100%;
            max-height: 500px;
        }
        .status {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš¨ ç´§æ€¥ä¿®å¤ç‰ˆæ’­æ”¾å™¨</h1>
            <p>æç®€ç‰ˆæœ¬ï¼Œä¸“æ³¨è§£å†³æ’­æ”¾é—®é¢˜</p>
        </div>
        
        <div class="controls">
            <input type="file" id="fileInput" class="file-input" accept="video/*">
            <br>
            <input type="text" id="urlInput" class="url-input" placeholder="æˆ–è¾“å…¥è§†é¢‘URL">
            <button onclick="loadURL()">åŠ è½½URL</button>
            <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>
        
        <div class="video-container">
            <video id="mainVideo" controls style="display:none;"></video>
            <div id="placeholder">è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶æˆ–è¾“å…¥URL</div>
        </div>
        
        <div class="status" id="status">ç­‰å¾…æ“ä½œ...</div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let video = null;
        let fileInput = null;
        let urlInput = null;
        let placeholder = null;
        let status = null;

        // ç®€å•æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            const logMessage = `[${timestamp}] ${prefix} ${message}`;
            
            console.log(logMessage);
            
            if (status) {
                status.innerHTML += `<span class="${type}">${logMessage}</span>\n`;
                status.scrollTop = status.scrollHeight;
            }
        }

        function clearLog() {
            if (status) {
                status.innerHTML = '';
            }
            console.clear();
            log('æ—¥å¿—å·²æ¸…é™¤');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('å¼€å§‹åˆå§‹åŒ–...');
            
            try {
                // è·å–å…ƒç´ 
                video = document.getElementById('mainVideo');
                fileInput = document.getElementById('fileInput');
                urlInput = document.getElementById('urlInput');
                placeholder = document.getElementById('placeholder');
                status = document.getElementById('status');
                
                if (!video || !fileInput || !urlInput) {
                    throw new Error('å…³é”®å…ƒç´ æœªæ‰¾åˆ°');
                }
                
                log('å…ƒç´ è·å–æˆåŠŸ', 'success');
                
                // è®¾ç½®æ–‡ä»¶è¾“å…¥äº‹ä»¶
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        loadFile(file);
                    }
                });
                
                // è®¾ç½®è§†é¢‘äº‹ä»¶
                video.addEventListener('loadedmetadata', function() {
                    log(`è§†é¢‘åŠ è½½æˆåŠŸ: ${video.duration.toFixed(2)}ç§’`, 'success');
                    showVideo();
                });
                
                video.addEventListener('error', function(e) {
                    log(`è§†é¢‘é”™è¯¯: ${e.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                });
                
                video.addEventListener('canplay', function() {
                    log('è§†é¢‘å¯ä»¥æ’­æ”¾', 'success');
                });
                
                log('äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ', 'success');
                log('åˆå§‹åŒ–å®Œæˆï¼Œå‡†å¤‡å°±ç»ªï¼', 'success');
                
            } catch (error) {
                log(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        });

        // åŠ è½½æœ¬åœ°æ–‡ä»¶
        function loadFile(file) {
            log(`å¼€å§‹åŠ è½½æ–‡ä»¶: ${file.name} (${(file.size/1024/1024).toFixed(2)}MB)`);
            
            try {
                // éªŒè¯æ–‡ä»¶ç±»å‹
                if (!file.type.startsWith('video/')) {
                    log(`è­¦å‘Š: æ–‡ä»¶ç±»å‹å¯èƒ½ä¸æ”¯æŒ (${file.type})`, 'error');
                }
                
                // åˆ›å»ºURL
                const url = URL.createObjectURL(file);
                log('æ–‡ä»¶URLåˆ›å»ºæˆåŠŸ');
                
                // è®¾ç½®è§†é¢‘æº
                video.src = url;
                log('è§†é¢‘æºè®¾ç½®å®Œæˆ');
                
                // æ¸…ç†æ—§çš„URLï¼ˆé¿å…å†…å­˜æ³„æ¼ï¼‰
                video.addEventListener('loadstart', function() {
                    log('å¼€å§‹åŠ è½½è§†é¢‘æ•°æ®...');
                }, { once: true });
                
            } catch (error) {
                log(`æ–‡ä»¶åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åŠ è½½URL
        function loadURL() {
            const url = urlInput.value.trim();
            if (!url) {
                log('è¯·è¾“å…¥æœ‰æ•ˆçš„URL', 'error');
                return;
            }
            
            log(`å¼€å§‹åŠ è½½URL: ${url}`);
            
            try {
                video.src = url;
                log('URLè®¾ç½®å®Œæˆ');
            } catch (error) {
                log(`URLåŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ˜¾ç¤ºè§†é¢‘
        function showVideo() {
            try {
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
                video.style.display = 'block';
                log('è§†é¢‘æ˜¾ç¤ºæˆåŠŸ', 'success');
            } catch (error) {
                log(`æ˜¾ç¤ºè§†é¢‘å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            log(`å…¨å±€é”™è¯¯: ${e.message}`, 'error');
        });

        window.addEventListener('unhandledrejection', function(e) {
            log(`æœªå¤„ç†çš„Promiseé”™è¯¯: ${e.reason}`, 'error');
        });

        // é˜²æ­¢é¡µé¢åˆ·æ–°æ—¶çš„ç¡®è®¤å¯¹è¯æ¡†
        window.addEventListener('beforeunload', function(e) {
            // æ¸…ç†å¯¹è±¡URL
            if (video && video.src && video.src.startsWith('blob:')) {
                URL.revokeObjectURL(video.src);
            }
        });
    </script>
</body>
</html>