<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–æ’­æ”¾å™¨ - è°ƒè¯•ç‰ˆæœ¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
        }
        .video-container {
            width: 100%;
            height: 400px;
            background: #000;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        video {
            max-width: 100%;
            max-height: 100%;
            border-radius: 8px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        button, input[type="file"] {
            padding: 10px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .status {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ ç®€åŒ–æ’­æ”¾å™¨ - è°ƒè¯•ç‰ˆæœ¬</h1>
        
        <div class="controls">
            <input type="file" id="fileInput" accept="video/*,audio/*">
            <button id="playBtn" disabled>æ’­æ”¾</button>
            <button id="pauseBtn" disabled>æš‚åœ</button>
            <button onclick="clearStatus()">æ¸…é™¤æ—¥å¿—</button>
        </div>
        
        <div class="video-container">
            <video id="video" controls style="display: none;"></video>
            <div id="placeholder">è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶</div>
        </div>
        
        <div class="status" id="status">ç­‰å¾…æ–‡ä»¶ä¸Šä¼ ...</div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const video = document.getElementById('video');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const status = document.getElementById('status');
        const placeholder = document.getElementById('placeholder');
        
        let currentFile = null;

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            
            status.innerHTML += `<span class="${className}">[${timestamp}] ${prefix} ${message}</span>\n`;
            status.scrollTop = status.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearStatus() {
            status.innerHTML = '';
        }

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            currentFile = file;
            
            log(`æ–‡ä»¶é€‰æ‹©: ${file.name}`, 'info');
            log(`æ–‡ä»¶å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB`, 'info');
            log(`æ–‡ä»¶ç±»å‹: ${file.type}`, 'info');

            try {
                // æ–¹æ³•1: ä½¿ç”¨ URL.createObjectURL
                log('å°è¯•æ–¹æ³•1: URL.createObjectURL', 'info');
                const videoUrl = URL.createObjectURL(file);
                video.src = videoUrl;
                
                video.onloadedmetadata = () => {
                    log(`âœ… å…ƒæ•°æ®åŠ è½½æˆåŠŸ`, 'success');
                    log(`è§†é¢‘æ—¶é•¿: ${video.duration.toFixed(2)} ç§’`, 'success');
                    log(`è§†é¢‘å°ºå¯¸: ${video.videoWidth}x${video.videoHeight}`, 'success');
                    
                    // æ˜¾ç¤ºè§†é¢‘ï¼Œéšè—å ä½ç¬¦
                    video.style.display = 'block';
                    placeholder.style.display = 'none';
                    
                    // å¯ç”¨æ§åˆ¶æŒ‰é’®
                    playBtn.disabled = false;
                    pauseBtn.disabled = false;
                    
                    log('ğŸ® æ§ä»¶å·²å¯ç”¨ï¼Œå¯ä»¥æ’­æ”¾äº†ï¼', 'success');
                };

                video.onerror = (e) => {
                    log(`âŒ è§†é¢‘åŠ è½½é”™è¯¯: ${e.message || 'Unknown error'}`, 'error');
                    tryMethod2();
                };

                video.oncanplay = () => {
                    log('âœ… è§†é¢‘å¯ä»¥æ’­æ”¾', 'success');
                };

                video.onplaying = () => {
                    log('â–¶ï¸ è§†é¢‘å¼€å§‹æ’­æ”¾', 'success');
                };

                video.onpause = () => {
                    log('â¸ï¸ è§†é¢‘æš‚åœ', 'info');
                };

            } catch (error) {
                log(`âŒ æ–¹æ³•1å¤±è´¥: ${error.message}`, 'error');
                tryMethod2();
            }
        });

        // æ–¹æ³•2: å¤‡ç”¨æ–¹æ¡ˆ
        async function tryMethod2() {
            if (!currentFile) return;
            
            log('å°è¯•æ–¹æ³•2: FileReader + Blob URL', 'info');
            
            try {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const arrayBuffer = e.target.result;
                    const blob = new Blob([arrayBuffer], { type: currentFile.type });
                    const blobUrl = URL.createObjectURL(blob);
                    
                    video.src = blobUrl;
                    log('âœ… æ–¹æ³•2è®¾ç½®å®Œæˆ', 'success');
                };
                
                reader.onerror = () => {
                    log('âŒ æ–¹æ³•2ä¹Ÿå¤±è´¥äº†', 'error');
                    showFallbackMessage();
                };
                
                reader.readAsArrayBuffer(currentFile);
                
            } catch (error) {
                log(`âŒ æ–¹æ³•2é”™è¯¯: ${error.message}`, 'error');
                showFallbackMessage();
            }
        }

        function showFallbackMessage() {
            log('ğŸ“ å»ºè®®: è¯·å°è¯•ä½¿ç”¨æ ‡å‡†çš„MP4æ–‡ä»¶', 'info');
            log('ğŸ“ æˆ–è€…ä½¿ç”¨åœ¨çº¿è§†é¢‘URL', 'info');
        }

        // æ’­æ”¾æ§åˆ¶
        playBtn.addEventListener('click', () => {
            log('ğŸ® ç‚¹å‡»æ’­æ”¾æŒ‰é’®', 'info');
            video.play().then(() => {
                log('âœ… æ’­æ”¾å¼€å§‹', 'success');
            }).catch(error => {
                log(`âŒ æ’­æ”¾å¤±è´¥: ${error.message}`, 'error');
            });
        });

        pauseBtn.addEventListener('click', () => {
            log('ğŸ® ç‚¹å‡»æš‚åœæŒ‰é’®', 'info');
            video.pause();
        });

        // æµ‹è¯•æµè§ˆå™¨åŠŸèƒ½
        log('ğŸ§ª æµè§ˆå™¨åŠŸèƒ½æ£€æµ‹:', 'info');
        log(`- HTML5 Video: ${!!video.canPlayType}`, 'info');
        log(`- WebGL: ${!!document.createElement('canvas').getContext('webgl')}`, 'info');
        log(`- WebGPU: ${!!navigator.gpu}`, 'info');
        log(`- WebCodecs: ${!!window.VideoDecoder}`, 'info');
        log(`- AudioWorklet: ${!!window.AudioWorklet}`, 'info');
        log(`- SharedArrayBuffer: ${!!window.SharedArrayBuffer}`, 'info');
        log('', 'info');

        // æ”¯æŒçš„è§†é¢‘æ ¼å¼æ£€æµ‹
        const formats = [
            'video/mp4; codecs="avc1.42E01E"',
            'video/mp4; codecs="avc1.4D401E"', 
            'video/mp4; codecs="hev1.1.6.L93.B0"',
            'video/webm; codecs="vp8"',
            'video/webm; codecs="vp9"'
        ];

        log('ğŸ“‹ æ”¯æŒçš„è§†é¢‘æ ¼å¼:', 'info');
        formats.forEach(format => {
            const support = video.canPlayType(format);
            log(`- ${format}: ${support || 'No'}`, 'info');
        });
        log('', 'info');
        log('âœ… åˆå§‹åŒ–å®Œæˆï¼Œè¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶è¿›è¡Œæµ‹è¯•', 'success');
    </script>
</body>
</html>